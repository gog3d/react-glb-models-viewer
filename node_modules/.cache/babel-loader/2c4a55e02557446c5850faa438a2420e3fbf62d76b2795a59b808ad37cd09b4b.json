{"ast":null,"code":"import _objectWithoutProperties from \"/home/gog3d/CODE/JS/1-projects/2-react/react-glb-models-viewer/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nvar _excluded = [\"aberrationStrength\", \"fastChroma\", \"envMap\"];\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport * as React from 'react';\nimport { useRef, useMemo, useLayoutEffect } from 'react';\nimport { extend, useThree } from '@react-three/fiber';\nimport { MeshBVH, SAH } from 'three-mesh-bvh';\nimport { MeshRefractionMaterial as MeshRefractionMaterial$1 } from '../materials/MeshRefractionMaterial.js';\nvar isCubeTexture = function isCubeTexture(def) {\n  return def && def.isCubeTexture;\n};\nfunction MeshRefractionMaterial(_ref2) {\n  var _ref2$aberrationStren = _ref2.aberrationStrength,\n    aberrationStrength = _ref2$aberrationStren === void 0 ? 0 : _ref2$aberrationStren,\n    _ref2$fastChroma = _ref2.fastChroma,\n    fastChroma = _ref2$fastChroma === void 0 ? true : _ref2$fastChroma,\n    envMap = _ref2.envMap,\n    props = _objectWithoutProperties(_ref2, _excluded);\n  extend({\n    MeshRefractionMaterial: MeshRefractionMaterial$1\n  });\n  var material = useRef();\n  var _useThree = useThree(),\n    size = _useThree.size;\n  var defines = useMemo(function () {\n    var _ref, _envMap$image$;\n    var temp = {}; // Sampler2D and SamplerCube need different defines\n\n    var isCubeMap = isCubeTexture(envMap);\n    var w = (_ref = isCubeMap ? (_envMap$image$ = envMap.image[0]) == null ? void 0 : _envMap$image$.width : envMap.image.width) !== null && _ref !== void 0 ? _ref : 1024;\n    var cubeSize = w / 4;\n    var _lodMax = Math.floor(Math.log2(cubeSize));\n    var _cubeSize = Math.pow(2, _lodMax);\n    var width = 3 * Math.max(_cubeSize, 16 * 7);\n    var height = 4 * _cubeSize;\n    if (isCubeMap) temp.ENVMAP_TYPE_CUBEM = '';\n    temp.CUBEUV_TEXEL_WIDTH = \"\".concat(1.0 / width);\n    temp.CUBEUV_TEXEL_HEIGHT = \"\".concat(1.0 / height);\n    temp.CUBEUV_MAX_MIP = \"\".concat(_lodMax, \".0\"); // Add defines from chromatic aberration\n\n    if (aberrationStrength > 0) temp.CHROMATIC_ABERRATIONS = '';\n    if (fastChroma) temp.FAST_CHROMA = '';\n    return temp;\n  }, [aberrationStrength, fastChroma]);\n  useLayoutEffect(function () {\n    var _material$current, _material$current$__r, _material$current$__r2;\n\n    // Get the geometry of this materials parent\n    var geometry = (_material$current = material.current) == null ? void 0 : (_material$current$__r = _material$current.__r3f) == null ? void 0 : (_material$current$__r2 = _material$current$__r.parent) == null ? void 0 : _material$current$__r2.geometry; // Update the BVH\n\n    if (geometry) material.current.bvh.updateFrom(new MeshBVH(geometry.toNonIndexed(), {\n      lazyGeneration: false,\n      strategy: SAH\n    }));\n  }, []);\n  return /*#__PURE__*/React.createElement(\"meshRefractionMaterial\", _extends({\n    // @ts-ignore\n    key: JSON.stringify(defines) // @ts-ignore\n    ,\n\n    defines: defines,\n    ref: material,\n    resolution: [size.width, size.height],\n    aberrationStrength: aberrationStrength,\n    envMap: envMap\n  }, props));\n}\nexport { MeshRefractionMaterial };","map":{"version":3,"names":["_extends","React","useRef","useMemo","useLayoutEffect","extend","useThree","MeshBVH","SAH","MeshRefractionMaterial","MeshRefractionMaterial$1","isCubeTexture","def","_ref2","_ref2$aberrationStren","aberrationStrength","_ref2$fastChroma","fastChroma","envMap","props","_objectWithoutProperties","_excluded","material","_useThree","size","defines","_ref","_envMap$image$","temp","isCubeMap","w","image","width","cubeSize","_lodMax","Math","floor","log2","_cubeSize","pow","max","height","ENVMAP_TYPE_CUBEM","CUBEUV_TEXEL_WIDTH","concat","CUBEUV_TEXEL_HEIGHT","CUBEUV_MAX_MIP","CHROMATIC_ABERRATIONS","FAST_CHROMA","_material$current","_material$current$__r","_material$current$__r2","geometry","current","__r3f","parent","bvh","updateFrom","toNonIndexed","lazyGeneration","strategy","createElement","key","JSON","stringify","ref","resolution"],"sources":["/home/gog3d/CODE/JS/1-projects/2-react/react-glb-models-viewer/node_modules/@react-three/drei/core/MeshRefractionMaterial.js"],"sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as React from 'react';\nimport { useRef, useMemo, useLayoutEffect } from 'react';\nimport { extend, useThree } from '@react-three/fiber';\nimport { MeshBVH, SAH } from 'three-mesh-bvh';\nimport { MeshRefractionMaterial as MeshRefractionMaterial$1 } from '../materials/MeshRefractionMaterial.js';\n\nconst isCubeTexture = def => def && def.isCubeTexture;\n\nfunction MeshRefractionMaterial({\n  aberrationStrength = 0,\n  fastChroma = true,\n  envMap,\n  ...props\n}) {\n  extend({\n    MeshRefractionMaterial: MeshRefractionMaterial$1\n  });\n  const material = useRef();\n  const {\n    size\n  } = useThree();\n  const defines = useMemo(() => {\n    var _ref, _envMap$image$;\n\n    const temp = {}; // Sampler2D and SamplerCube need different defines\n\n    const isCubeMap = isCubeTexture(envMap);\n    const w = (_ref = isCubeMap ? (_envMap$image$ = envMap.image[0]) == null ? void 0 : _envMap$image$.width : envMap.image.width) !== null && _ref !== void 0 ? _ref : 1024;\n    const cubeSize = w / 4;\n\n    const _lodMax = Math.floor(Math.log2(cubeSize));\n\n    const _cubeSize = Math.pow(2, _lodMax);\n\n    const width = 3 * Math.max(_cubeSize, 16 * 7);\n    const height = 4 * _cubeSize;\n    if (isCubeMap) temp.ENVMAP_TYPE_CUBEM = '';\n    temp.CUBEUV_TEXEL_WIDTH = `${1.0 / width}`;\n    temp.CUBEUV_TEXEL_HEIGHT = `${1.0 / height}`;\n    temp.CUBEUV_MAX_MIP = `${_lodMax}.0`; // Add defines from chromatic aberration\n\n    if (aberrationStrength > 0) temp.CHROMATIC_ABERRATIONS = '';\n    if (fastChroma) temp.FAST_CHROMA = '';\n    return temp;\n  }, [aberrationStrength, fastChroma]);\n  useLayoutEffect(() => {\n    var _material$current, _material$current$__r, _material$current$__r2;\n\n    // Get the geometry of this materials parent\n    const geometry = (_material$current = material.current) == null ? void 0 : (_material$current$__r = _material$current.__r3f) == null ? void 0 : (_material$current$__r2 = _material$current$__r.parent) == null ? void 0 : _material$current$__r2.geometry; // Update the BVH\n\n    if (geometry) material.current.bvh.updateFrom(new MeshBVH(geometry.toNonIndexed(), {\n      lazyGeneration: false,\n      strategy: SAH\n    }));\n  }, []);\n  return /*#__PURE__*/React.createElement(\"meshRefractionMaterial\", _extends({\n    // @ts-ignore\n    key: JSON.stringify(defines) // @ts-ignore\n    ,\n    defines: defines,\n    ref: material,\n    resolution: [size.width, size.height],\n    aberrationStrength: aberrationStrength,\n    envMap: envMap\n  }, props));\n}\n\nexport { MeshRefractionMaterial };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}